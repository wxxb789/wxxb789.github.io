:PROPERTIES:
:title: readwise/25｜机器学习：我们能用机器学习来建立投资模型吗？
:END:

:PROPERTIES:
:author: [[geekbang.org]]
:full-title: "25｜机器学习：我们能用机器学习来建立投资模型吗？"
:category: [[articles]]
:url: https://time.geekbang.org/column/article/416033
:tags:[[gt/程序员的个人财富课]],
:image-url: https://static001.geekbang.org/resource/image/d4/53/d4563db2f69c76ea8b518898c42e9a53.jpeg
:END:

* Highlights first synced by [[Readwise]] [[2023-12-18]]
** 📌
#+BEGIN_QUOTE
![](https://static001.geekbang.org/resource/image/e9/75/e99539d00942af53aa79eb5878afdc75.jpg?wh=2248x828) 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhapmhvt0jdyn5nst6tstn)
** 📌
#+BEGIN_QUOTE
接下来，我们也会基于这个问题，讲一讲从样本生成、特征选取、模型训练，再到模型预估的大致思路。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhazvajwa1yfb1svaxds2t)
** 📌
#+BEGIN_QUOTE
训练样本和特征如何生成？

在训练模型之前，我们首先要解决训练样本如何生成，以及训练所需的特征和标签如何处理的问题。

那么，对于一个预测股票涨跌的问题，我们一般使用滑动窗口的形式去生成训练样本。如图 2，它是某只股票半年时间内的价格走势图。

在生成训练样本时，我们先选取一个滑动窗口长度，比如 10 个数据点。然后，选择一个滑动起点，从这个起点开始，逐个数据点地向右侧滑动，每滑动一次生成一个训练样本。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhbamtnzqvn31h3c38mceb)
** 📌
#+BEGIN_QUOTE
在滑动过程中，每个窗口内的行情数据就作为历史数据，我们可以从中提取出行情相关的特征。而窗口外右侧的第一帧数据，就作为样本的标签。如果是涨的话，就标记该样本是正样本，跌的话就是负样本。当然，如果你希望训练的是一个回归模型，也可以把股票的涨跌幅度这个连续值当作样本标签。直到向右滑动结束，处理完全部的行情数据，我们就完成了样本的生成。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhbfvnk87traht7pwkd4ba)
** 📌
#+BEGIN_QUOTE
特征一般分为两大部分，一是场内行情特征，二是场外特征。其中，场内行情特征指的是利用滑动窗口内部的行情数据，比如股票价格、成交量、换手率等信息处理出来的特征。场外特征是当时当刻跟这只股票相关的所有其他数据，比如这家公司基本面的数据，宏观经济数据等等。

但需要注意，不管什么特征都要遵循一个基本原则，就是一定要用滑动窗口那个所在时间段的数据生成当时当刻的特征，而不能引入窗口之后的任何数据。因为这样就相当于引入了未来信息，属于模型训练中的作弊行为。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhbt336y2wny7gn7mv8kpp)
** 📌
#+BEGIN_QUOTE
什么样的模型结构适合股价预测？ 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhc22r9ayh1aw92y5a3jz0)
** 📌
#+BEGIN_QUOTE
如图 3 所示，因为行情数据天然是序列化的，所以序列模型自然就是最适合处理行情数据的模型。事实上，国内的量化投资公司某方，以及国外的量化巨头 two sigma，都披露过序列模型在它们投资场景下的成功应用。序列模型也曾经在 two sigma 举办的股票预测大赛中大放异彩，如果你想具体了解，可以看这个链接。那接下来，我就讲一下序列模型的应用。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhdjng1xp0z020abn7861v)
** 📌
#+BEGIN_QUOTE
对于一个序列模型来说，最重要的是要清楚它的基本结构和输入输出。下面的图 4 就是一个经典的序列模型结构示意图。其中 x1 到 xt+1 就是它的输入，y1 到 yt+1 是它的输出，每个蓝色模块间的 at，就是不同状态间传递的权重信息。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhdsxb50fjvm5cc1y1ctr3)
** 📌
#+BEGIN_QUOTE
那序列模型是如何应用在预测股价这个问题上的呢？其实这个过程是很直观的。输入 xt 其实就代表每一时刻股价相关的特征向量，你可以把我们准备好的多因子特征都放到这个向量中去。比如，向量的第一个维度代表成交量，第二个维度代表上一刻的涨跌幅度，第三个维度代表动量因子，等等。输出 yt 代表的就是我们希望利用 xt 预测出的结果，就是 t 时刻下一刻的股票涨跌结果。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhecfj0dnyr3va120xz48t)
** 📌
#+BEGIN_QUOTE
这就是利用序列模型预测股票的全过程。在实际操作中，当然有大量细节工作需要准备，比如特征的选取，样本的处理，预估相关服务的搭建，等等。此外，模型结构的选择也对预测结果有关键性的影响，比如经典的序列模型就包括 RNN、LSTM、GRU 等等。想了解这些模型细节的同学，可以进一步参考机器学习领域的相关资料。在之后的番外篇里，我也会给你推荐一些相关的书籍和文章。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhernfqksr05j3k34smj3s)
** 📌
#+BEGIN_QUOTE
根据很多业内人士的经验，序列模型在高频场景下是更容易出效果的，但是在天和月级别的低频领域，每个时刻的结果只跟前一个时刻关系较大，跟更早时刻的特征相关性就很弱了。这个时候，序列模型的特点就很难发挥出来，我们就应该使用更合适的模型去挖掘当前时刻不同因子之间的相互关系。比如，可以使用更善于解决特征交叉问题的 XGboost，或者 DeepFM 等模型。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhfm60wtykhpc5yxx8fq2q)
** 📌
#+BEGIN_QUOTE
举几个具体的例子来说吧。我们一起来看图 5 展示的 DeepFM 的模型结构，你可以直观地看到，不同输入特征之间存在很多连线，这就意味着 DeepFM 这个模型希望通过特征交叉学到它们之间的相互作用。

还有上一讲提到的线性多因子模型，它只能给每个因子一个权重，我们没法给因子 1 且因子 2 这样的交叉因子一个权重。但直观上来讲，这种复杂的交叉因子往往包含了更有价值的信息，比如当股价和交易量同时上涨这个信号出现时，后续的股价往往有更强的上涨动能，那么这样的交叉特征就更容易被 DeepFM 这类模型捕获。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhg18736bhwzx3d5pkvd1b)
** 📌
#+BEGIN_QUOTE
![](https://static001.geekbang.org/resource/image/85/a2/851ccbfec150052aa770f1f806bbcba2.jpg?wh=1920x843) 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhg3smxe6jnzk92frgh7zx)
** 📌
#+BEGIN_QUOTE
魔鬼藏在细节里

上面，我给出了用机器学习模型预测投资问题的基本方案，但要构建一个真正有效的模型，要做的工作还远不止于此，因为还存在大量可能影响最终效果的细节问题。

西方有句谚语叫“魔鬼藏在细节里”，这一点我们程序员肯定都深有体会。因为即使整体方案再“高大上”，在实现过程中，只要一个细节不注意，得到的结果就可能天差地别。我们的日常工作如此，构建一个投资模型更是如此。因为要注意的细节问题实在太多了，这里我不能全都列出来，但我可以列出两个最关键的，希望对你有所启发。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhhmtktpn3vh9zvbfg4k79)
** 📌
#+BEGIN_QUOTE
数据清洗问题

这里，我们还是拿预测股价走势当例子。对于机器学习模型来说，我们希望发现的是一些比较稳定的数据模式和规律，这就要求我们剔除一些存在异常的数据。

比如，把刚上市的新股剔除掉，因为它们的表现往往具有独特性；把刚开市时前几分钟以及闭市前最后几分钟的数据点剔除掉，因为这个时段的数据噪音也比较大；把一些垃圾股，以及近期受政策影响较大的股票剔除掉，因为这些数据也不具备一般性。依此类推，当我们清洗掉大部分异常数据之后，在留下的数据中，更有可能发掘到稳定的、预测准确度高的规律。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhhw172dkabws8ra995gxc)
** 📌
#+BEGIN_QUOTE
问题的定义

事实上，和建立一个通用的覆盖所有股票的模型相比，把问题的范围缩小，是更容易训练出一个有效的预测模型的。那怎么把问题的范围缩小呢？你可以参考下面这几种做法： 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhjjh38wd9x5ykmraty96r)
** 📌
#+BEGIN_QUOTE
我们可以缩小时间区间，比如只利用闭市前 30 分钟的走势来预测第二天的开盘行情。

我们也可以缩小股票区间，比如只去研究科技类股票的走势。

我们还可以有针对性地定义问题。比如，确定自己要构建的机器学习模型是用来预测螺纹钢跟动力煤价格的相对走势的，并在这个基础上构建配对交易的策略。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhjb1eqqcw6t15v16tj6ch)
** 📌
#+BEGIN_QUOTE
![](https://static001.geekbang.org/resource/image/a6/c9/a6a9cb0e7413a67171bdb484ce9efcc9.jpg?wh=1920x552) 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhj0ahaq5qw33h2rr14xw3)
** 📌
#+BEGIN_QUOTE
复杂模型容易产生严重的过拟合现象。

由于深度学习的黑盒特征，在模型效果变差时，我们很难给出有效的解释。

和推荐系统数据相比，金融数据里的噪声更大，很多数据点都是杂乱的随机波动。而且，埋藏在杂乱数据下的潜在规律也在随时变化，这让深度学习模型学习到稳定数据模式的难度变大，且模型的有效期更短。

这三点局限性，不仅会困扰散户投资者，而且也让一线的量化投资团队相当头疼。为了尽量规避这三点局限性，专业的量化团队会在模型结构优化、数据清洗、模型实时更新等多个方向上进行改进。我们可以在技术上学习这些做法，但同时也要牢记：作为散户，我们的时间、精力和资源都是有限的，一定要把有限的时间用在解决一个规模较小的问题上，这样才有可能在一个点上击败专业投资者。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhk2st50jwgzfg4gsvcx65)
** 📌
#+BEGIN_QUOTE
用机器学习解决投资问题，本质思路跟解决推荐、广告问题是一样的，只不过二者所利用的特征完全不同。

在股票预测中，训练数据是通过滑动窗口滑动生成的。在生成过程中要避免引入未来信息。

LSTM、RNN 等序列模型常被用于解决跟走势相关的预测问题，XGboost、DeepFM 等模型更善于处理特征交叉的问题。

影响机器学习模型成败的关键在于细节。严格的数据清洗和精准的问题定义，都是成功的关键。

机器学习模型在投资领域的应用存在着局限性，最重要的三点是过拟合，黑盒特性以及金融数据的强随机性。我们要懂得扬长避短，尽量规避这些局限性。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhk6rd62tqqynw4g6m0d2t)
** 📌
#+BEGIN_QUOTE
在睡梦里，我认为股票的涨停随着我的想法决定涨或停； 在对未来的期望里，我认为预测未来哪只股票会上涨，完全是小菜一碟； 但当我清醒时，我的理智告诉我：预测分钟级的螺纹钢期货涨跌是比较现实的，因为随着时间的推移，各种不可控因素变得越来越多，时间越长，预测准确度越来越低，只有在较短的时间里，才能将各种影响因素缩小到可控范围，提高预测准确度。股票里的技术分析，诸如KDJ，MACD，布林线等，一般都用来预测短期行情，前期好的行情离得越近，越能判断近期涨势，两个离得近的金叉，比两个离得远的金叉可信度要高，我想这跟股市的瞬息万变强相关，上一秒好的行情可能在下一秒就变差了，时间越长，用于预测的有效信息偏离性越大。 由此可见，越是稳定的走势，越有利于预测分析，我能虽然无法准确预测哪只股票会涨，但是我们可以判断哪些股票较差，基于这一点，可不可以利用机器学习使用相同数据周期性进行预测呢？比如：对近期的股票以周为单位进行一次技术分析，通过综合对比，剔除以周为单位走势较差的股票，留下相对平稳的股票，待大范围选取相对好的股票后，再以天为单位对股票进行预测。

作者回复: 比如：对近期的股票以周为单位进行一次技术分析，通过综合对比，剔除以周为单位走势较差的股票，留下相对平稳的股票，待大范围选取相对好的股票后，再以天为单位对股票进行预测。 这个想法是非常好的，就是文中提到的要更注重细节，把更多精力花在数据清洗，特征筛选上，这样才能提高模型的准确率。 
#+END_QUOTE
    date:: [[2023-04-12]]
*** from _25｜机器学习：我们能用机器学习来建立投资模型吗？_ by geekbang.org
*** [View Highlight](https://read.readwise.io/read/01gxrhkj20nbpf8y2vcb1k5tpx)